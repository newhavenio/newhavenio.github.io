<template id="meetup-events-error-template" type="x-tmpl-mustache">
  <div class="alert alert-danger">
    {{message}}
  </div>
</template>

<template id="meetup-events-loading-template" type="x-tmpl-mustache">
  <div class="alert alert-info">
    Loading events&hellip;
  </div>
</template>

<script>
  (function (component) {
    var API_ATTRS = {
      'api-key': 'key',
      group: 'group_urlname',
      'max-events': 'page'
    };

    var errorTemplate = component
      .getElementById('meetup-events-error-template')
      .innerHTML;
    Mustache.parse(errorTemplate);

    var loadingTemplate = component
      .getElementById('meetup-events-loading-template')
      .innerHTML;
    Mustache.parse(loadingTemplate);

    var MeetupEventsElement = Object.create(HTMLElement.prototype, {
      createdCallback: {
        value: function createdCallback() {
          this.refresh();
        }
      },

      attributeChangedCallback: {
        value: function attributeChangedCallback(attrName) {
          if (Object.keys(API_ATTRS).indexOf(attrName) >= 0) {
            this.refresh();
          }
        }
      },

      render: {
        value: function render(data) {
          var events = {"results":[{"utc_offset":-18000000,"venue":{"country":"us","localized_country_name":"USA","city":"New Haven","address_1":"New Haven","name":"TBD ","lon":-72.924622,"id":20006312,"state":"CT","lat":41.307621,"repinned":false},"headcount":0,"visibility":"public","waitlist_count":0,"created":1515628180000,"maybe_rsvp_count":0,"description":"<p>Grab a drink and talk shop<\/p>","event_url":"https:\/\/www.meetup.com\/newhavenio\/events\/246693696\/","yes_rsvp_count":15,"duration":7200000,"name":"Social Night","id":"246693696","time":1516316400000,"updated":1515628180000,"group":{"join_mode":"open","created":1305132370000,"name":"NewHaven.IO","group_lon":-72.94000244140625,"id":1843611,"urlname":"newhavenio","group_lat":41.33000183105469,"who":"Techies"},"status":"upcoming"},{"utc_offset":-18000000,"venue":{"zip":"06511","country":"us","localized_country_name":"USA","city":"New Haven","address_1":"760 Chapel Street","name":"The Grove","lon":-72.923515,"id":13397482,"state":"CT","lat":41.304993,"repinned":false},"headcount":0,"visibility":"public","waitlist_count":0,"created":1515358154000,"maybe_rsvp_count":0,"description":"<p>• What we'll do<br\/>It's time to kick off 2018 for NewHaven.io!<\/p> <p>We'll be holding an organizational \"Town Hall\" where we can all touch base on where the org stands and where we're going. Anyone involved in NHV.io in any way is welcome.<\/p> <p>Agenda:<br\/>* re-establishing official roles and positions to be held by members<br\/>* electing members to roles<br\/>* scheduling quarterly \"organizing\" events<br\/>* setting some goals for the upcoming year<br\/>* running a retrospective of the past year(s) of the group: what went well that we can continue doing, what can we improve that we can experiment on<\/p> <p>Parking:<br\/>There's a parking lot across the street on Nicoll Street for mActivity use. If the lot is full there's some street parking nearby on Nicoll Street between Willow Street and Mitchell Drive. There's also a parking lot next to mActivity that is unreliable and should only be used as a last resort (it may or may not be locked, and cars may or may not get locked in until we get someone to let us out). Remember to lock your car and take all valuables with you.<\/p> <p>• What to bring<\/p> <p>• Important to know<\/p>","how_to_find_us":"Clubhouse Room: In the front doors, up the stairs past the elevator, then take a left at the top of the stairs, past the table top group toward the back of the building up the half staircase to the back room","event_url":"https:\/\/www.meetup.com\/newhavenio\/events\/246587766\/","yes_rsvp_count":16,"duration":7200000,"name":"NHV.io Organizing Meeting - 2018 Kickoff \/ Town Hall","id":"246587766","time":1516921200000,"updated":1515612757000,"group":{"join_mode":"open","created":1305132370000,"name":"NewHaven.IO","group_lon":-72.94000244140625,"id":1843611,"urlname":"newhavenio","group_lat":41.33000183105469,"who":"Techies"},"status":"upcoming"},{"utc_offset":-18000000,"venue":{"country":"us","localized_country_name":"USA","city":"New Haven","address_1":"59 Elm Street, Suite 300 (3rd floor)","name":"Continuity","lon":0,"id":23910459,"state":"CT","lat":0,"repinned":false},"headcount":0,"visibility":"public","waitlist_count":0,"created":1466475565000,"maybe_rsvp_count":0,"description":"<p>If you want to give a short talk, let us know.<\/p> <p>Otherwise, come with a project you'd like to hack on, and enjoy the company of local developers.<\/p>","event_url":"https:\/\/www.meetup.com\/newhavenio\/events\/246307875\/","yes_rsvp_count":5,"duration":10800000,"name":"[Everyone] Full Stack Hack Night","id":"gbwffpyxdbcb","time":1517526000000,"updated":1515444749000,"group":{"join_mode":"open","created":1305132370000,"name":"NewHaven.IO","group_lon":-72.94000244140625,"id":1843611,"urlname":"newhavenio","group_lat":41.33000183105469,"who":"Techies"},"status":"upcoming"},{"utc_offset":-18000000,"venue":{"country":"us","localized_country_name":"USA","city":"New Haven","address_1":"59 Elm Street, Suite 300 (3rd floor)","name":"Continuity","lon":0,"id":23910459,"state":"CT","lat":0,"repinned":false},"headcount":0,"visibility":"public","waitlist_count":0,"created":1515444749000,"maybe_rsvp_count":0,"description":"<p>If you want to give a short talk, let us know.<\/p> <p>Otherwise, come with a project you'd like to hack on, and enjoy the company of local developers.<\/p>","event_url":"https:\/\/www.meetup.com\/newhavenio\/events\/246629921\/","yes_rsvp_count":2,"duration":10800000,"name":"[Everyone] Full Stack Hack Night","id":"gbwffpyxfbcb","time":1519945200000,"updated":1515444749000,"group":{"join_mode":"open","created":1305132370000,"name":"NewHaven.IO","group_lon":-72.94000244140625,"id":1843611,"urlname":"newhavenio","group_lat":41.33000183105469,"who":"Techies"},"status":"upcoming"},{"utc_offset":-14400000,"venue":{"country":"us","localized_country_name":"USA","city":"New Haven","address_1":"59 Elm Street, Suite 300 (3rd floor)","name":"Continuity","lon":0,"id":23910459,"state":"CT","lat":0,"repinned":false},"headcount":0,"visibility":"public","waitlist_count":0,"created":1515444749000,"maybe_rsvp_count":0,"description":"<p>If you want to give a short talk, let us know.<\/p> <p>Otherwise, come with a project you'd like to hack on, and enjoy the company of local developers.<\/p>","event_url":"https:\/\/www.meetup.com\/newhavenio\/events\/246629917\/","yes_rsvp_count":2,"duration":10800000,"name":"[Everyone] Full Stack Hack Night","id":"gbwffpyxgbhb","time":1522965600000,"updated":1515444749000,"group":{"join_mode":"open","created":1305132370000,"name":"NewHaven.IO","group_lon":-72.94000244140625,"id":1843611,"urlname":"newhavenio","group_lat":41.33000183105469,"who":"Techies"},"status":"upcoming"}],"meta":{"next":"https:\/\/api.meetup.com\/2\/events?offset=1&sign=True&format=json&limited_events=False&group_urlname=newhavenio&callback=jsonp_callback__658&page=5&fields=&key=6e7b85c3fc96f524d133273a4556&order=time&desc=false&status=upcoming","method":"Events","total_count":14,"link":"https:\/\/api.meetup.com\/2\/events","count":5,"description":"Access Meetup events using a group, member, or event id. Events in private groups are available only to authenticated members of those groups. To search events by topic or location, see [Open Events](\/meetup_api\/docs\/2\/open_events).","lon":"","title":"Meetup Events v2","url":"https:\/\/api.meetup.com\/2\/events?offset=0&sign=True&format=json&limited_events=False&group_urlname=newhavenio&callback=jsonp_callback__658&page=5&fields=&key=6e7b85c3fc96f524d133273a4556&order=time&desc=false&status=upcoming","signed_url":"https:\/\/api.meetup.com\/2\/events?offset=0&format=json&limited_events=False&group_urlname=newhavenio&callback=jsonp_callback__658&page=5&fields=&order=time&desc=false&status=upcoming&sig_id=152409852&sig=f01e1069b422adb027d69fb22bb2d7fd1a9532d9","id":"","updated":1515628180000,"lat":""}}['results']
          this.innerHTML = '';
          events.forEach(function (eventData) {
            var eventCard = document.createElement('meetup-event-card');
            eventCard.data = eventData;
            this.appendChild(eventCard);
          }, this);
        }
      },

      showLoading: {
        value: function showLoading() {
          this.innerHTML = Mustache.render(loadingTemplate);
        }
      },

      showError: {
        value: function showError(error) {
          this.innerHTML = Mustache.render(errorTemplate, {
            message: String(error)
          });
        }
      },

      getApiParams: {
        value: function() {
          var missingAttrs = false;
          var params = {};
          Object.keys(API_ATTRS).forEach(function (attrName) {
            var attr = this.getAttribute(attrName);
            params[API_ATTRS[attrName]] = attr;
            missingAttrs = missingAttrs || (attr == null);
          }, this);
          return missingAttrs ? null : params;
        }
      },

      refresh: {
        value: function refresh() {
          var _this = this;
          var params = this.getApiParams();
          if (!(params)) { return; }

          function done(data) {
            _this.render(data);
            Meetup.triggerEvent.call(_this, 'refresh', data);
          }

          function fail(error) {
            _this.showError(error);
            Meetup.triggerEvent.call(_this, 'error', error);
          }

          //this.showLoading();
          //Meetup.fetchData(Meetup.eventsUrl(params), done, fail);
          _this.render([]);
        }
      }
    });

    document.registerElement(
      'meetup-events',
      {prototype: MeetupEventsElement}
    );
  }(document._currentScript.ownerDocument));
</script>
